<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>body {
  max-width: 980px;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable,
.markdown-body .highlighttable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr,
.markdown-body .highlighttable {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite,
.markdown-body .highlighttable pre,
.markdown-body .highlighttable div.highlight {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td,
.markdown-body .highlighttable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite,
.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.highlight {background-color:#fff;color:#333333;}
.highlight .hll {background-color:#ffffcc;}
.highlight .c{color:#999988;font-style:italic}
.highlight .err{color:#a61717;background-color:#e3d2d2}
.highlight .k{font-weight:bold}
.highlight .o{font-weight:bold}
.highlight .cm{color:#999988;font-style:italic}
.highlight .cp{color:#999999;font-weight:bold}
.highlight .c1{color:#999988;font-style:italic}
.highlight .cs{color:#999999;font-weight:bold;font-style:italic}
.highlight .gd{color:#000000;background-color:#ffdddd}
.highlight .ge{font-style:italic}
.highlight .gr{color:#aa0000}
.highlight .gh{color:#999999}
.highlight .gi{color:#000000;background-color:#ddffdd}
.highlight .go{color:#888888}
.highlight .gp{color:#555555}
.highlight .gs{font-weight:bold}
.highlight .gu{color:#800080;font-weight:bold}
.highlight .gt{color:#aa0000}
.highlight .kc{font-weight:bold}
.highlight .kd{font-weight:bold}
.highlight .kn{font-weight:bold}
.highlight .kp{font-weight:bold}
.highlight .kr{font-weight:bold}
.highlight .kt{color:#445588;font-weight:bold}
.highlight .m{color:#009999}
.highlight .s{color:#dd1144}
.highlight .n{color:#333333}
.highlight .na{color:teal}
.highlight .nb{color:#0086b3}
.highlight .nc{color:#445588;font-weight:bold}
.highlight .no{color:teal}
.highlight .ni{color:purple}
.highlight .ne{color:#990000;font-weight:bold}
.highlight .nf{color:#990000;font-weight:bold}
.highlight .nn{color:#555555}
.highlight .nt{color:navy}
.highlight .nv{color:teal}
.highlight .ow{font-weight:bold}
.highlight .w{color:#bbbbbb}
.highlight .mf{color:#009999}
.highlight .mh{color:#009999}
.highlight .mi{color:#009999}
.highlight .mo{color:#009999}
.highlight .sb{color:#dd1144}
.highlight .sc{color:#dd1144}
.highlight .sd{color:#dd1144}
.highlight .s2{color:#dd1144}
.highlight .se{color:#dd1144}
.highlight .sh{color:#dd1144}
.highlight .si{color:#dd1144}
.highlight .sx{color:#dd1144}
.highlight .sr{color:#009926}
.highlight .s1{color:#dd1144}
.highlight .ss{color:#990073}
.highlight .bp{color:#999999}
.highlight .vc{color:teal}
.highlight .vg{color:teal}
.highlight .vi{color:teal}
.highlight .il{color:#009999}
.highlight .gc{color:#999;background-color:#EAF2F5}
</style><title>JSON_API</title></head><body><article class="markdown-body"><h1 id="jsonapi">JSON:API<a class="headerlink" href="#jsonapi" title="Permanent link"></a></h1>
<p>JSON:API is a standard format described at <a href="https://jsonapi.org/">https://jsonapi.org/</a>.</p>
<details>
  <summary>JSON:API FORMAT EXAMPLE</summary>

  <div class="highlight"><pre><span class="k">class</span> <span class="nc">JsonapiSerializer</span> <span class="o">&lt;</span> <span class="no">Jat</span>
  <span class="n">plugin</span> <span class="ss">:json_api</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">JsonapiSerializer</span>
  <span class="n">config</span><span class="o">[</span><span class="ss">:exposed</span><span class="o">]</span> <span class="o">=</span> <span class="ss">:default</span> <span class="c1"># Default value can be omitted. Other options: :all, :none</span>

  <span class="n">type</span> <span class="ss">:user</span>

  <span class="n">attribute</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="o">[</span><span class="n">user</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">last_name</span><span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">relationship</span> <span class="ss">:profile</span><span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="no">ProfileSerializer</span> <span class="p">},</span> <span class="ss">exposed</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">relationship</span> <span class="ss">:roles</span><span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="no">RoleSerializer</span> <span class="p">},</span> <span class="ss">exposed</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">ProfileSerializer</span> <span class="o">&lt;</span> <span class="no">JsonapiSerializer</span>
  <span class="n">type</span> <span class="ss">:profile</span>

  <span class="n">attribute</span><span class="p">(</span><span class="ss">:location</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">profile</span><span class="o">|</span> <span class="n">profile</span><span class="o">.</span><span class="n">location</span> <span class="o">||</span> <span class="s2">&quot;New York City&quot;</span> <span class="p">}</span>
  <span class="n">attribute</span> <span class="ss">:followers_count</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">RoleSerializer</span> <span class="o">&lt;</span> <span class="no">JsonapiSerializer</span>
  <span class="n">type</span> <span class="ss">:role</span>

  <span class="n">attribute</span> <span class="ss">:name</span>
<span class="k">end</span>

<span class="nb">require</span> <span class="s2">&quot;ostruct&quot;</span>
<span class="n">role1</span> <span class="o">=</span> <span class="no">OpenStruct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;superhero&quot;</span><span class="p">)</span>
<span class="n">role2</span> <span class="o">=</span> <span class="no">OpenStruct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;reporter&quot;</span><span class="p">)</span>
<span class="n">profile</span> <span class="o">=</span> <span class="no">OpenStruct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">followers_count</span><span class="p">:</span> <span class="mi">999</span><span class="p">,</span> <span class="ss">location</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span>
<span class="n">user</span> <span class="o">=</span> <span class="no">OpenStruct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">first_name</span><span class="p">:</span> <span class="s2">&quot;Clark&quot;</span><span class="p">,</span> <span class="ss">last_name</span><span class="p">:</span> <span class="s2">&quot;Kent&quot;</span><span class="p">,</span> <span class="ss">profile</span><span class="p">:</span> <span class="n">profile</span><span class="p">,</span> <span class="ss">roles</span><span class="p">:</span> <span class="o">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="o">]</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

<span class="nb">require</span> <span class="s2">&quot;json&quot;</span>
<span class="nb">puts</span> <span class="no">JSON</span><span class="o">.</span><span class="n">pretty_generate</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>

  <div class="highlight"><pre><span class="p">{</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Clark Kent&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;profile&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;profile&quot;</span><span class="p">,</span>
          <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&quot;roles&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;role&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;role&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;included&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;profile&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;Gotham City&quot;</span><span class="p">,</span>
        <span class="nt">&quot;followers_count&quot;</span><span class="p">:</span> <span class="mi">999</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;role&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
      <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;superhero&quot;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;role&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="nt">&quot;attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;reporter&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</details>

<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link"></a></h2>
<ul>
<li><a href="#activation">Activation</a></li>
<li><a href="#serialization">Serialization</a></li>
<li><a href="#dsl">DSL</a></li>
<li><a href="#type-and-id">Type and ID</a></li>
<li><a href="#attribute">Attribute</a></li>
<li><a href="#relationship">Relationship</a></li>
<li><a href="#config">Config</a></li>
<li><a href="#meta">Meta</a><ul>
<li>[Document Meta]</li>
<li>[Object Meta]</li>
<li>[Relationship Meta]</li>
</ul>
</li>
<li><a href="#links">Links</a><ul>
<li>[Document Links]</li>
<li>[Object Links]</li>
<li>[Relationship Links]</li>
</ul>
</li>
<li><a href="#jsonapi">Jsonapi</a></li>
<li><a href="#plugins">Plugins</a></li>
<li><a href="#preloads">Preloads</a></li>
<li><a href="#activerecord">Activerecord</a></li>
<li><a href="#validate-params">Validate Params</a></li>
<li><a href="#serializing-to-string">Serializing to String</a></li>
<li><a href="#caching">Caching</a></li>
<li><a href="#lower-camel-case">Lower Camel Case</a></li>
<li><a href="#internal-cache">Internal Cache</a></li>
<li><a href="#miscellaneous">Miscellaneous</a></li>
<li><a href="#configure-exposed-attributes">Configure Exposed Attributes</a></li>
<li>[Additional Meta]</li>
<li><a href="#paging">Paging</a></li>
</ul>
<h2 id="activation">Activation<a class="headerlink" href="#activation" title="Permanent link"></a></h2>
<p>JSON:API is activated by adding <code>plugin :json_api</code></p>
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">ResponseSerializer</span> <span class="o">&lt;</span> <span class="no">Jat</span>
    <span class="n">plugin</span> <span class="ss">:json_api</span>

    <span class="c1"># Other plugins</span>
    <span class="n">plugin</span> <span class="ss">:activerecord</span> <span class="c1"># auto preload</span>
    <span class="n">plugin</span> <span class="ss">:validate_params</span> <span class="c1"># adds validate methods that check context[:fields]</span>
    <span class="n">plugin</span> <span class="ss">:to_str</span> <span class="c1"># allows to serialize object to JSON string</span>
    <span class="n">plugin</span> <span class="ss">:cache</span> <span class="c1"># allows to provide context[:cache] to cache response</span>
    <span class="n">plugin</span> <span class="ss">:maps_cache</span> <span class="c1"># improves serialization performance by caching some internal data in class variables</span>
    <span class="n">plugin</span> <span class="ss">:lower_camel_case</span> <span class="c1"># automatically transforms all attribute to lowerCamelCase.</span>
  <span class="k">end</span>
</pre></div>

<h2 id="serialization">Serialization<a class="headerlink" href="#serialization" title="Permanent link"></a></h2>
<p>Serializer accepts object and context parameters.
  <div class="highlight"><pre>  <span class="no">ResponseSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="c1"># context is optional, empty hash by default</span>
</pre></div></p>
<p>If <code>context</code> is constant, then performance can be slightly improved by saving serializer instance in some variable and reusing it.
  <div class="highlight"><pre>  <span class="n">serializer</span> <span class="o">=</span> <span class="no">ResponseSerializer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
  <span class="n">serializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
</pre></div></p>
<p>Serializer detects if we serialize one object or a list by checking <code>object.is_a?(Enumerable)</code>, but we can configure this directly via context <code>:many</code> option
  <div class="highlight"><pre>  <span class="no">ResponseSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="ss">many</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
</pre></div></p>
<p>Context has three system options that configures attributes to serialize:
  * <code>:exposed</code> - allows to expose all or no attributes. Allowed values are <code>:all</code>, <code>:none</code>, <code>:default</code>.
  * <code>:fields</code> - <a href="https://jsonapi.org/format/#fetching-sparse-fieldsets">Sparse Fieldsets</a>
  * <code>:include</code> - <a href="https://jsonapi.org/format/#fetching-includes">Inclusion of Related Resources</a>
  <div class="highlight"><pre>  <span class="no">ResponseSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span>
    <span class="n">objects</span><span class="p">,</span>
    <span class="ss">exposed</span><span class="p">:</span> <span class="ss">:none</span><span class="p">,</span>
    <span class="ss">fields</span><span class="p">:</span> <span class="p">{</span><span class="ss">user</span><span class="p">:</span> <span class="s1">&#39;name,surname&#39;</span><span class="p">,</span> <span class="ss">address</span><span class="p">:</span> <span class="s1">&#39;line1,line2&#39;</span><span class="p">,</span> <span class="ss">profile</span><span class="p">:</span> <span class="s1">&#39;bio&#39;</span><span class="p">}</span>
    <span class="ss">includes</span><span class="p">:</span> <span class="s1">&#39;profile,addresses.some_nested_relationship&#39;</span>
</pre></div>
  Look at <a href="#configure-exposed-attributes">Configure Exposed Attributes</a> for more information.</p>
<h2 id="dsl">DSL<a class="headerlink" href="#dsl" title="Permanent link"></a></h2>
<p>All DSL methods are inherited by subclasses and can be redefined by subclasses.</p>
<h3 id="type-and-id">Type and ID<a class="headerlink" href="#type-and-id" title="Permanent link"></a></h3>
<p>Every JSON:API serializer must define type and id to identify resource.
  <code>Type</code> is a constant string value that must be specified. Specifying ID is not required, as usually it is <code>resource.id</code>, but it can be overwritten.</p>
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
    <span class="c1"># Required</span>
    <span class="n">type</span> <span class="ss">:users</span>

    <span class="c1"># Optional</span>
    <span class="nb">id</span><span class="p">(</span><span class="ss">key</span><span class="p">:</span> <span class="ss">:id</span><span class="p">)</span> <span class="c1"># this is default</span>
    <span class="nb">id</span><span class="p">(</span><span class="ss">key</span><span class="p">:</span> <span class="ss">:username</span><span class="p">)</span> <span class="c1"># Use user.username as ID</span>
    <span class="nb">id</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span> <span class="n">context</span><span class="o">|</span> <span class="n">f</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="p">}</span> <span class="c1"># use custom function to find ID</span>
  <span class="k">end</span>
</pre></div>

<h3 id="attribute">Attribute<a class="headerlink" href="#attribute" title="Permanent link"></a></h3>
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
    <span class="c1"># Serializes `object.email`</span>
    <span class="n">attribute</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span>

    <span class="c1"># Serializes `object.confirmed_email`</span>
    <span class="n">attribute</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="ss">key</span><span class="p">:</span> <span class="ss">:confirmed_email</span><span class="p">)</span>

    <span class="c1"># When provided block without args, we can specify direct value</span>
    <span class="n">attribute</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;example@example.com &#39;</span><span class="p">}</span>

    <span class="c1"># Define block with object argument</span>
    <span class="n">attribute</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="n">user</span><span class="o">.</span><span class="n">confirmed_email</span> <span class="p">}</span>

    <span class="c1"># Define block with object and context arguments</span>
    <span class="n">attribute</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span> <span class="n">ctx</span><span class="o">|</span> <span class="n">user</span><span class="o">.</span><span class="n">confirmed_email</span> <span class="o">||</span> <span class="n">ctx</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span> <span class="p">}</span>
  <span class="k">end</span>
</pre></div>

<h3 id="relationship">Relationship<a class="headerlink" href="#relationship" title="Permanent link"></a></h3>
<p><code>relationship</code> is an alias of <code>attribute</code>, but with forced <code>:serializer</code> option. If two serializers have cross referenced relationships, they should be defined as callable lambdas.</p>
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
    <span class="c1"># Serializes `object.profile`</span>
    <span class="n">relationship</span> <span class="ss">:profile</span><span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span> <span class="no">ProfileSerializer</span>

    <span class="c1"># Serializes `object.main_profile`</span>
    <span class="n">relationship</span> <span class="ss">:profile</span><span class="p">,</span> <span class="ss">key</span><span class="p">:</span> <span class="ss">:main_profile</span><span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="no">ProfileSerializer</span> <span class="p">}</span>

    <span class="c1"># Serializes result of block execution</span>
    <span class="n">relationship</span><span class="p">(</span><span class="ss">:profile</span><span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="no">ProfileSerializer</span> <span class="p">})</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span> <span class="n">_ctx</span><span class="o">|</span>
      <span class="n">user</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:last</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>

<p>We can manually specify if relationship returns one object or a list by adding <code>:many</code> option. By default we will check <code>is_a?(Enumerable)</code> on serialized object.
  <div class="highlight"><pre>  <span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
    <span class="c1"># Serializes `object.profile`</span>
    <span class="n">relationship</span> <span class="ss">:profile</span><span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span> <span class="no">ProfileSerializer</span><span class="p">,</span> <span class="ss">many</span><span class="p">:</span> <span class="kp">false</span>
    <span class="n">relationship</span> <span class="ss">:addresses</span><span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span> <span class="no">AddressSerializer</span><span class="p">,</span> <span class="ss">many</span><span class="p">:</span> <span class="kp">true</span>
  <span class="k">end</span>
</pre></div></p>
<h3 id="config">Config<a class="headerlink" href="#config" title="Permanent link"></a></h3>
<p>We can change or check config options this way:</p>
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
    <span class="n">config</span><span class="o">[</span><span class="ss">:foo</span><span class="o">]</span> <span class="o">=</span> <span class="ss">:bar</span> <span class="c1"># add config option</span>
  <span class="k">end</span>

  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">config</span> <span class="c1"># show current config</span>
</pre></div>

<h3 id="meta">Meta<a class="headerlink" href="#meta" title="Permanent link"></a></h3>
<p>JSON:API allow to place meta at any of three response levels:</p>
<pre><code>- Document Meta
- Relationship meta
- Object meta
</code></pre>
<p>Example of all levels of meta
  <div class="highlight"><pre>{
  meta: {} # Top level meta,
  data: {
    type: &#39;type&#39;,
    id: &#39;id&#39;,
    attributes: [],
    relationships: {
      nested_resource: {
        meta: {} # Relationship meta
      }
    },
    meta: {} # Object meta
  },
}
</pre></div></p>
<h4 id="document-meta">Document Meta<a class="headerlink" href="#document-meta" title="Permanent link"></a></h4>
<p><code>document_meta</code> specifies top-level metadata attribute. There are only main serializer document meta in response. If nested relationships define some document_meta, it will not be shown in response. Meta attribute will be skipped if block returns nil.</p>
<p><a href="https://jsonapi.org/format/#document-meta">https://jsonapi.org/format/#document-meta</a></p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
  <span class="n">document_meta</span><span class="p">(</span><span class="ss">:version</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;1.2.3&#39;</span> <span class="p">}</span>
  <span class="n">document_meta</span><span class="p">(</span><span class="ss">:paging</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">objects</span><span class="p">,</span> <span class="n">context</span><span class="o">|</span> <span class="o">...</span> <span class="p">}</span> <span class="c1"># access to serialized object(s) or context</span>
<span class="k">end</span>
</pre></div>

<p>📌 Document metadata can be added by specifying <code>:meta</code> context option. Meta defined in context have precedence over meta defined in serializer.</p>
<p>Example:
  <div class="highlight"><pre>  <span class="c1"># {</span>
  <span class="c1">#   data: { ... },</span>
  <span class="c1">#   meta: { version: &#39;2.0&#39; }</span>
  <span class="c1"># }</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="ss">meta</span><span class="p">:</span> <span class="p">{</span> <span class="ss">version</span><span class="p">:</span> <span class="s1">&#39;2.0&#39;</span> <span class="p">})</span>
</pre></div></p>
<p>#### Relationship Meta
  <code>relationship_meta</code> specifies metadata attribute that is placed in relationships objects. Meta attribute will be skipped if block returns nil.</p>
<p><a href="https://jsonapi.org/format/#document-resource-object-relationships">https://jsonapi.org/format/#document-resource-object-relationships</a></p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
  <span class="n">relationship_meta</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;bar&#39;</span> <span class="p">}</span>
  <span class="n">relationship_meta</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">objects</span><span class="p">,</span> <span class="n">context</span><span class="o">|</span> <span class="o">...</span> <span class="p">}</span> <span class="c1"># access to serialized object(s) or context</span>
<span class="k">end</span>
</pre></div>

<p>#### Object Meta
  <code>object_meta</code> specifies metadata attribute that is placed in objects. Meta attribute will be skipped if block returns nil.</p>
<p><a href="https://jsonapi.org/format/#document-resource-object-relationships">https://jsonapi.org/format/#document-resource-object-relationships</a></p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
  <span class="n">object_meta</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;bar&#39;</span> <span class="p">}</span>
  <span class="n">object_meta</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">object</span><span class="p">,</span> <span class="n">context</span><span class="o">|</span> <span class="o">...</span> <span class="p">}</span> <span class="c1"># access to serialized object or context</span>
<span class="k">end</span>
</pre></div>

<h3 id="links">Links<a class="headerlink" href="#links" title="Permanent link"></a></h3>
<p>JSON:API allow to place links at any of three response levels:</p>
<pre><code>- Document links
- Relationship links
- Object links
</code></pre>
<p>Example of all levels of links
  <div class="highlight"><pre>{
  links: {} # Top level links,
  data: {
    type: &#39;type&#39;,
    id: &#39;id&#39;,
    attributes: [],
    relationships: {
      nested_resource: {
        links: {} # Relationship links
      }
    },
    links: {} # Object links
  },
}
</pre></div></p>
<h4 id="document-links">Document Links<a class="headerlink" href="#document-links" title="Permanent link"></a></h4>
<p><code>document_meta</code> specifies top-level links attribute. There are only main serializer document_links in response. If nested relationships define some document_link, it will not be shown in response. Link will be skipped if block returns nil.</p>
<p><a href="https://jsonapi.org/format/#document-top-level">https://jsonapi.org/format/#document-top-level</a></p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
  <span class="n">document_link</span><span class="p">(</span><span class="ss">:self</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span> <span class="n">context</span><span class="o">|</span>
    <span class="n">context</span><span class="o">[</span><span class="ss">:action</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span> <span class="p">?</span> <span class="s1">&#39;/users&#39;</span> <span class="p">:</span> <span class="s2">&quot;/user/</span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>📌 Document top-level links can be added by specifying <code>:links</code> context option. Links defined in context have precedence over links defined in serializer.</p>
<p>Example:
  <div class="highlight"><pre>  <span class="c1"># {</span>
  <span class="c1">#   data: { ... },</span>
  <span class="c1">#   links: { current: &#39;/user/123&#39; }</span>
  <span class="c1"># }</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="ss">links</span><span class="p">:</span> <span class="p">{</span> <span class="ss">current</span><span class="p">:</span> <span class="s1">&#39;/user/123&#39;</span> <span class="p">})</span>
</pre></div></p>
<p>#### Relationship Links
  <code>relationship_link</code> specifies link that is placed in relationships objects. Link will be skipped if block returns nil.</p>
<p><a href="https://jsonapi.org/format/#document-resource-object-linkage">https://jsonapi.org/format/#document-resource-object-linkage</a></p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
  <span class="n">relationship_link</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;bar&#39;</span> <span class="p">}</span>
  <span class="n">relationship_link</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">objects</span><span class="p">,</span> <span class="n">context</span><span class="o">|</span> <span class="o">...</span> <span class="p">}</span> <span class="c1"># access to serialized object(s) or context</span>
<span class="k">end</span>
</pre></div>

<p>#### Object Links
  <code>object_link</code> specifies link that is placed in objects. Link will be skipped if block returns nil.</p>
<p><a href="https://jsonapi.org/format/#document-resource-objects">https://jsonapi.org/format/#document-resource-objects</a></p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
  <span class="n">object_link</span><span class="p">(</span><span class="ss">:self</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;/user/</span><span class="si">#{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<h3 id="jsonapi_1">JSONAPI<a class="headerlink" href="#jsonapi_1" title="Permanent link"></a></h3>
<p><code>jsonapi</code> adds document jsonapi object</p>
<p><a href="https://jsonapi.org/format/#document-jsonapi-object">https://jsonapi.org/format/#document-jsonapi-object</a></p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
  <span class="n">jsonapi</span><span class="p">(</span><span class="ss">:version</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;1.0&#39;</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<h2 id="plugins">Plugins<a class="headerlink" href="#plugins" title="Permanent link"></a></h2>
<h3 id="preloads">Preloads<a class="headerlink" href="#preloads" title="Permanent link"></a></h3>
<p>Plugin <code>:preloads</code> adds methods to show <code>preloads</code> hash. It can be used with you favorite database ORM to omit N+1.</p>
<p>All relationships by default add preloads that match current relationship key. Preloads can be changed by providing <code>:preload</code> option on any attribute or relationship. Preloads from nested relationships are also
  merged to current <code>preloads</code> result.</p>
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">ResponseSerializer</span> <span class="o">&lt;</span> <span class="no">Jat</span>
    <span class="n">plugin</span> <span class="ss">:json_api</span>
    <span class="n">plugin</span> <span class="ss">:preloads</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
    <span class="c1"># preloads nothing for attributes</span>
    <span class="n">attribute</span> <span class="ss">:email</span>

    <span class="c1"># preloads `:addresses` as specified manually</span>
    <span class="n">attribute</span><span class="p">(</span><span class="ss">:address</span><span class="p">,</span> <span class="ss">preload</span><span class="p">:</span> <span class="ss">:addresses</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">object</span><span class="o">|</span> <span class="n">object</span><span class="o">.</span><span class="n">addresses</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:main</span><span class="p">)</span><span class="o">.</span><span class="n">address</span> <span class="p">}</span>

    <span class="c1"># preloads :account</span>
    <span class="n">relationship</span> <span class="ss">:account</span><span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="no">AccountSerializer</span> <span class="p">}</span>

    <span class="c1"># preloads :hashtags</span>
    <span class="n">relationship</span> <span class="ss">:tag</span><span class="p">,</span> <span class="ss">key</span><span class="p">:</span> <span class="ss">:hashtags</span><span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="no">HashtagSerializer</span> <span class="p">}</span>

    <span class="c1"># preloads { avatar_attachment: :blob: }</span>
    <span class="n">relationship</span> <span class="ss">:avatar</span><span class="p">,</span> <span class="ss">preload</span><span class="p">:</span> <span class="p">{</span> <span class="ss">avatar_attachment</span><span class="p">:</span> <span class="ss">:blob</span> <span class="p">},</span> <span class="ss">serializer</span><span class="p">:</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="no">AvatarSerializer</span> <span class="p">}</span>

    <span class="c1"># disable preloads for relationships (add nil or false value)</span>
    <span class="n">relationship</span> <span class="ss">:foo</span><span class="p">,</span> <span class="ss">preloads</span><span class="p">:</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span><span class="o">-&gt;</span> <span class="p">{</span> <span class="no">FooSerializer</span> <span class="p">}</span>
    <span class="n">relationship</span> <span class="ss">:bar</span><span class="p">,</span> <span class="ss">preloads</span><span class="p">:</span> <span class="kp">false</span> <span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span><span class="o">-&gt;</span> <span class="p">{</span> <span class="no">BarSerializer</span> <span class="p">}</span>
  <span class="k">end</span>

<span class="k">class</span> <span class="nc">AccountSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span><span class="p">;</span>
  <span class="n">attribute</span><span class="p">(</span><span class="ss">:plan</span><span class="p">,</span> <span class="ss">preload</span><span class="p">:</span> <span class="ss">:plan</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">obj</span><span class="o">|</span> <span class="n">obj</span><span class="o">.</span><span class="n">plan</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">HashtagSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span><span class="p">;</span> <span class="k">end</span>
<span class="k">class</span> <span class="nc">AvatarSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span><span class="p">;</span> <span class="k">end</span>
<span class="k">class</span> <span class="nc">FooSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span><span class="p">;</span> <span class="k">end</span>
<span class="k">class</span> <span class="nc">BarSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span><span class="p">;</span> <span class="k">end</span>

  <span class="c1"># Generate preloads hash</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">preloads</span><span class="p">(</span><span class="ss">fields</span><span class="p">:</span> <span class="s1">&#39;email, address, account, tag, avatar, foo, bar&#39;</span><span class="p">)</span>
  <span class="c1"># or same</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">fields</span><span class="p">:</span> <span class="s1">&#39;email, address, account, tag, avatar, foo, bar&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">preloads</span>

  <span class="c1"># =&gt;</span>
  <span class="c1"># {</span>
  <span class="c1">#   addresses:{},</span>
  <span class="c1">#   account: {plan: {}},</span>
  <span class="c1">#   hashtags: {},</span>
  <span class="c1">#   avatar_attachment: {blob: {}},</span>
  <span class="c1"># }</span>
</pre></div>

<h3 id="activerecord">Activerecord<a class="headerlink" href="#activerecord" title="Permanent link"></a></h3>
<p>Plugin <code>:activerecord</code> loads <code>[Preloads]</code> plugin and uses ActiveRecord to automatically preload data to serialized object(s).</p>
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">ResponseSerializer</span> <span class="o">&lt;</span> <span class="no">Jat</span>
    <span class="n">plugin</span> <span class="ss">:json_api</span>
    <span class="n">plugin</span> <span class="ss">:activerecord</span>
  <span class="k">end</span>
</pre></div>

<h3 id="validate-params">Validate Params<a class="headerlink" href="#validate-params" title="Permanent link"></a></h3>
<p>Plugin <code>:validate_params</code> can be used to validate <code>fields</code> parameters and to get errors before serialization starts. Without it not existing fields attributes will be skipped.</p>
<p>Plugin adds class method <code>.validate(context)</code> and instance method <code>#validate</code>.</p>
<p>Example without validation:
  <div class="highlight"><pre>  <span class="k">class</span> <span class="nc">WithoutValidation</span> <span class="o">&lt;</span> <span class="no">Jat</span>
    <span class="n">plugin</span> <span class="ss">:json_api</span>
    <span class="n">attribute</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">obj</span><span class="o">|</span> <span class="n">obj</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="no">WithoutValidation</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="ss">fields</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span> <span class="c1"># =&gt; { foo: 1 }</span>
</pre></div></p>
<p>Example with validation:
  <div class="highlight"><pre>  <span class="k">class</span> <span class="nc">WithValidation</span> <span class="o">&lt;</span> <span class="no">Jat</span>
    <span class="n">plugin</span> <span class="ss">:json_api</span>
    <span class="n">plugin</span> <span class="ss">:validate_params</span>
    <span class="n">attribute</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">obj</span><span class="o">|</span> <span class="n">obj</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="c1"># adds validate method</span>
  <span class="no">WithValidation</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="ss">fields</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span> <span class="c1"># =&gt; Jat::SimpleApiFieldsError, &quot;Field &#39;bar&#39; not exists&quot;</span>
  <span class="no">WithValidation</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">fields</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span> <span class="c1"># =&gt; Jat::SimpleApiFieldsError, &quot;Field &#39;bar&#39; not exists&quot;</span>

  <span class="c1"># validates during serialization</span>
  <span class="no">WithValidation</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="ss">fields</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span> <span class="c1"># =&gt; Jat::SimpleApiFieldsError, &quot;Field &#39;bar&#39; not exists&quot;</span>
</pre></div></p>
<h3 id="serializing-to-string">Serializing to String<a class="headerlink" href="#serializing-to-string" title="Permanent link"></a></h3>
<p>Objects can be serialized to JSON string if we enable <code>:to_str</code> plugin. This plugin adds additional <code>.to_str</code> DSL method. By default JSON will be generated using ruby standard <code>JSON</code> library. This can be changed with your favorite adapter, it works like this:</p>
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">MySerializer</span> <span class="o">&lt;</span> <span class="no">Jat</span>
    <span class="n">plugin</span> <span class="ss">:json_api</span>
    <span class="n">plugin</span> <span class="ss">:to_str</span>
    <span class="n">config</span><span class="o">[</span><span class="ss">:to_str</span><span class="o">]</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span> <span class="p">{</span> <span class="no">Oj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="nb">hash</span><span class="p">,</span> <span class="ss">mode</span><span class="p">:</span> <span class="ss">:compat</span><span class="p">)</span> <span class="p">}</span> <span class="c1"># use Oj instead of JSON</span>
    <span class="c1"># ... some attributes</span>
  <span class="k">end</span>

  <span class="no">MySerializer</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
  <span class="c1"># or</span>
  <span class="no">MySerializer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</pre></div>

<h3 id="caching">Caching<a class="headerlink" href="#caching" title="Permanent link"></a></h3>
<p>Caching does not needed very often when serializing objects to hash, as it is usually a fast procedure. Most of the time people are constructing JSON API, so it will be more effective to cache serialized JSON strings. That&rsquo;s why, when enabled <code>:cache</code> plugin, <code>:to_str</code> plugin is also automatically enabled.</p>
<p>It is hard to predict how cache_key should look like and for how long cache should be stored. So it is not serializer&rsquo;s responsibility to know such stuff. Requester should provide a callable instance that will use some caching mechanism. Example:
  <div class="highlight"><pre>  <span class="n">cache</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="k">do</span> <span class="o">|</span><span class="n">object</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="o">|</span>
    <span class="c1"># Some code to construct cache key, usually you want to use:</span>
    <span class="c1"># - object.cache_key (for ActiveRecord)</span>
    <span class="c1"># - context[:params]</span>
    <span class="c1"># - context[:format] (:to_h | :to_str)</span>
    <span class="n">cache_key</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span>

    <span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="ss">expires_in</span><span class="p">:</span> <span class="mi">5</span><span class="o">.</span><span class="n">minutes</span><span class="p">)</span> <span class="p">{</span> <span class="n">block</span><span class="o">.</span><span class="p">()</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="ss">cache</span><span class="p">:</span> <span class="n">cache</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">)</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="ss">cache</span><span class="p">:</span> <span class="n">cache</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">)</span>
</pre></div></p>
<p>📌 Add <code>:cache</code> plugin only after <code>:activerecord</code> plugin to not preload relations each time even when response taken from cache.</p>
<h3 id="lower-camel-case">Lower Camel Case<a class="headerlink" href="#lower-camel-case" title="Permanent link"></a></h3>
<p>Enabled by requiring <code>plugin :lower_camel_case</code>.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
  <span class="n">plugin</span> <span class="ss">:json_api</span>
  <span class="n">plugin</span> <span class="ss">:lower_camel_case</span>

  <span class="n">attribute</span> <span class="ss">:foo_bar_bazz</span> <span class="c1"># becomes fooBarBazz in response</span>
<span class="k">end</span>
</pre></div>

<h3 id="internal-cache">Internal Cache<a class="headerlink" href="#internal-cache" title="Permanent link"></a></h3>
<p>Internal cache can be enabled with plugin <code>:maps_cache</code> to improve serialization performance. Structures (<strong>maps</strong>) that we generate after parsing <code>fields</code> parameter can be stored to use in next serialization. Cached <strong>maps</strong> are stored in class variable, maximum 100 <strong>maps</strong> are stored per serializer.</p>
<p>Performance improvement depends on serialized object and context, in example benchmark
serializing with enabled cache ~ 1.27x faster. <a href="/home/aglushkov/ruby/jat/doc/benchmarks/json_api/json_api_maps_cache_benchmark.rb">Internal cache benchmark script</a> attached.</p>
<div class="highlight"><pre>Comparison:
Include Internal Cache:    21608.0 i/s
Exclude Internal Cache:    17078.9 i/s - 1.27x  (± 0.00) slower
</pre></div>

<p>Enabling internal cache:</p>
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">ResponseSerializer</span> <span class="o">&lt;</span> <span class="no">Jat</span>
    <span class="n">plugin</span> <span class="ss">:json_api</span>
    <span class="n">plugin</span> <span class="ss">:maps_cache</span><span class="p">,</span> <span class="ss">cached_maps_count</span><span class="p">:</span> <span class="mi">50</span> <span class="c1"># default: 100</span>
  <span class="k">end</span>
</pre></div>

<h2 id="miscellaneous">Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permanent link"></a></h2>
<h3 id="configure-exposed-attributes">Configure Exposed Attributes<a class="headerlink" href="#configure-exposed-attributes" title="Permanent link"></a></h3>
<p>When developing application it is always a tricky question to find which attributes will be needed. Usually it is unwanted to expose everything, and at the same time it is unwanted to create different serializers with different attribute sets. This gem allows to configure what is needed. As exposing object attributes usually does not require additional (DB) queries, current gem exposes all attributes by default and hides all relationships.</p>
<p>📌 Rule of thumb:
  - <em>attributes</em> are <strong>exposed by default</strong>
  - <em>relationships</em> are <strong>hidden by default</strong></p>
<p>There are 4 ways to change this rule:</p>
<ol>
<li>Adding <code>config[:exposed]=:all/:none/:default</code> config option to set default exposed value for all attributes/relationships in current serializer.
      <div class="highlight"><pre>  <span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
    <span class="n">config</span><span class="o">[</span><span class="ss">:exposed</span><span class="o">]</span> <span class="o">=</span> <span class="ss">:none</span> <span class="c1"># :none, :all, :default</span>

    <span class="n">attribute</span> <span class="ss">:email</span>
    <span class="n">relationship</span> <span class="ss">:avatar</span><span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span> <span class="no">AvatarSerializer</span>
  <span class="k">end</span>
</pre></div></li>
<li>Adding <code>exposed: true/false</code> option per attribute. Per-attribute <code>exposed</code> option has precedence over <code>config[:exposed]</code> option.
      <div class="highlight"><pre>  <span class="k">class</span> <span class="nc">UserSerializer</span> <span class="o">&lt;</span> <span class="no">ResponseSerializer</span>
    <span class="n">attribute</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">exposed</span><span class="p">:</span> <span class="kp">false</span>
    <span class="n">relationship</span> <span class="ss">:avatar</span><span class="p">,</span> <span class="ss">serializer</span><span class="p">:</span> <span class="no">AvatarSerializer</span><span class="p">,</span> <span class="ss">exposed</span><span class="p">:</span> <span class="kp">true</span>
  <span class="k">end</span>
</pre></div></li>
<li>
<p>Adding <code>{ exposed: ':all/:none/:default' }</code> context when serializing object. This context option has precedence over per-attributes <code>:exposed</code> values. It changes exposed attributes in current serializer and all relationships. Exposed <code>:none</code> is useful only in combination with <code>fields</code> which additionally specifies exposed attributes, if you want full control over each serialized attribute.
      <div class="highlight"><pre>  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="c1"># returns all exposed by default attributes</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="ss">exposed</span><span class="p">:</span> <span class="ss">:default</span><span class="p">)</span> <span class="c1"># same, returns all exposed by default attributes</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="ss">exposed</span><span class="p">:</span> <span class="ss">:all</span><span class="p">)</span> <span class="c1"># returns all attributes of current and nested objects</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="ss">exposed</span><span class="p">:</span> <span class="ss">:none</span><span class="p">)</span> <span class="c1"># returns empty hash</span>
</pre></div></p>
</li>
<li>
<p>Adding standard JSON:API <code>fields</code> and <code>include</code> parameters when serializing object.</p>
<ul>
<li><a href="https://jsonapi.org/format/#fetching-sparse-fieldsets">https://jsonapi.org/format/#fetching-sparse-fieldsets</a></li>
<li><a href="https://jsonapi.org/format/#fetching-includes">https://jsonapi.org/format/#fetching-includes</a></li>
</ul>
<div class="highlight"><pre>  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="c1"># returns default attributes</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="ss">exposed</span><span class="p">:</span> <span class="ss">:default</span><span class="p">)</span> <span class="c1"># same, returns default attributes</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="ss">exposed</span><span class="p">:</span> <span class="ss">:all</span><span class="p">)</span> <span class="c1"># returns all attributes</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="ss">exposed</span><span class="p">:</span> <span class="ss">:none</span><span class="p">,</span> <span class="ss">fields</span><span class="p">:</span> <span class="p">{</span> <span class="ss">articles</span><span class="p">:</span> <span class="s1">&#39;title&#39;</span> <span class="p">})</span> <span class="c1"># returns only &#39;title&#39; attribute for articles, and no attributes for other types.</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="kp">include</span><span class="p">:</span> <span class="s1">&#39;articles&#39;</span><span class="p">)</span> <span class="c1"># returns default attributes and `articles relationship with default attributes</span>
  <span class="no">UserSerializer</span><span class="o">.</span><span class="n">to_h</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="ss">fields</span><span class="p">:</span> <span class="p">{</span> <span class="ss">articles</span><span class="p">:</span> <span class="s1">&#39;title,body&#39;</span><span class="p">,</span> <span class="ss">people</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">})</span> <span class="c1"># returns only `title` and `body` for articles and only `name` for people. Other types will be returned with default attributes.</span>
</pre></div>

</li>
</ol>
<h3 id="paging">Paging<a class="headerlink" href="#paging" title="Permanent link"></a></h3>
<p>There are no specific paging plugin, we can use <code>meta</code> defined on some base class.</p>
<div class="highlight"><pre>  <span class="k">class</span> <span class="nc">ResponseSerializer</span> <span class="o">&lt;</span> <span class="no">Jat</span>
    <span class="n">meta</span><span class="p">(</span><span class="ss">:paging</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">records</span><span class="p">,</span> <span class="n">context</span><span class="o">|</span>
      <span class="k">break</span> <span class="k">unless</span> <span class="n">context</span><span class="o">.</span><span class="n">dig</span><span class="p">(</span><span class="ss">:params</span><span class="p">,</span> <span class="ss">:page</span><span class="p">)</span>
      <span class="k">break</span> <span class="k">unless</span> <span class="n">records</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Enumerable</span><span class="p">)</span>
      <span class="k">break</span> <span class="k">unless</span> <span class="n">records</span><span class="o">.</span><span class="n">respond_to?</span><span class="p">(</span><span class="ss">:total_count</span><span class="p">)</span>

      <span class="p">{</span>
        <span class="ss">total_count</span><span class="p">:</span> <span class="n">records</span><span class="o">.</span><span class="n">total_count</span><span class="p">,</span>
        <span class="ss">size</span><span class="p">:</span> <span class="n">records</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
        <span class="ss">offset_value</span><span class="p">:</span> <span class="n">records</span><span class="o">.</span><span class="n">offset_value</span>
      <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>

<pre><code>[Document Meta]: #document-meta
[Relationship Meta]: #relationship-meta
[Object Meta]: #object-meta

[Document Links]: #document-links
[Relationship Links]: #relationship-links
[Object Links]: #object-links
</code></pre></article></body></html>